<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>GALACTIC DEFENDER: EXTREME</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@900&display=swap');

    * { box-sizing: border-box; touch-action: none; user-select: none; -webkit-tap-highlight-color: transparent; }
    
    body {
      margin: 0; padding: 0; background: #000;
      font-family: 'Orbitron', sans-serif;
      overflow: hidden; display: flex; align-items: center; justify-content: center;
      height: 100vh; width: 100vw;
    }

    #gameContainer {
      position: relative; width: 100%; height: 100%; max-width: 500px;
      background: #0a0a1a; border-left: 2px solid #444; border-right: 2px solid #444;
      overflow: hidden;
    }

    canvas { display: block; width: 100%; height: 100%; z-index: 1; }

    /* UI & HUD */
    .hud {
      position: absolute; top: 20px; width: 100%;
      display: flex; justify-content: space-between; padding: 0 20px;
      z-index: 10; pointer-events: none;
    }
    .score-label { color: #888; font-size: 10px; letter-spacing: 1px; }
    .score-val { font-size: 22px; color: #00ffcc; text-shadow: 0 0 5px #00ffcc; font-weight: 900; }
    
    .boss-warning {
      position: absolute; top: 40%; width: 100%; text-align: center;
      color: red; font-size: 40px; font-weight: 900; 
      text-shadow: 0 0 10px red; display: none; z-index: 15;
      animation: blink 0.2s infinite;
    }

    /* BUTTONS */
    .dash-wrapper {
      position: absolute; bottom: 30px; width: 100%;
      display: flex; justify-content: center; z-index: 20; pointer-events: auto;
    }
    .dash-btn {
      background: rgba(255, 0, 85, 0.2); border: 2px solid #ff0055;
      color: #fff; padding: 15px 50px; border-radius: 6px;
      font-family: 'Orbitron', sans-serif; font-size: 18px; 
      letter-spacing: 2px; text-transform: uppercase;
    }
    .dash-btn:active { background: #ff0055; transform: scale(0.95); }

    /* OVERLAY */
    .overlay {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.92);
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      z-index: 99;
    }
    .hidden { display: none !important; }

    h1 { color: #ff3333; font-size: 32px; text-align: center; margin-bottom: 5px; text-shadow: 0 0 20px #ff0000; }
    .subtitle { color: #fff; font-size: 12px; letter-spacing: 4px; margin-bottom: 30px; }

    .btn-start {
      background: #00ffcc; color: #000; border: none; padding: 15px 50px;
      font-family: 'Orbitron', sans-serif; font-size: 18px; font-weight: 900;
      clip-path: polygon(10% 0, 100% 0, 100% 70%, 90% 100%, 0 100%, 0 30%);
      cursor: pointer;
    }

    @keyframes blink { 0% {opacity:1} 50% {opacity:0} 100% {opacity:1} }
    .shake { animation: shake 0.5s; }
    @keyframes shake { 0% {transform: translate(1px, 1px) rotate(0deg);} 10% {transform: translate(-1px, -2px) rotate(-1deg);} 20% {transform: translate(-3px, 0px) rotate(1deg);} 30% {transform: translate(3px, 2px) rotate(0deg);} 40% {transform: translate(1px, -1px) rotate(1deg);} 50% {transform: translate(-1px, 2px) rotate(-1deg);} 60% {transform: translate(-3px, 1px) rotate(0deg);} 70% {transform: translate(3px, 1px) rotate(-1deg);} 80% {transform: translate(-1px, -1px) rotate(1deg);} 90% {transform: translate(1px, 2px) rotate(0deg);} 100% {transform: translate(1px, -2px) rotate(-1deg);} }

    .touch-zone { position: absolute; top: 0; height: 100%; width: 50%; z-index: 5; }
    #zone-left { left: 0; }
    #zone-right { right: 0; }
  </style>
</head>
<body>

<div id="gameContainer">
  <canvas id="gameCanvas"></canvas>
  <div id="zone-left" class="touch-zone"></div>
  <div id="zone-right" class="touch-zone"></div>

  <div class="hud">
    <div><div class="score-label">SCORE</div><div class="score-val" id="scoreEl">0</div></div>
    <div style="text-align:right"><div class="score-label">BEST</div><div class="score-val" id="bestEl">0</div></div>
  </div>
  
  <div class="boss-warning" id="bossWarn">WARNING<br>BOSS DETECTED</div>

  <div class="dash-wrapper">
    <button class="dash-btn" id="btnDash">âš¡ BOOST</button>
  </div>

  <div class="overlay" id="menuOverlay">
    <h1>GALACTIC<br>EXTREME</h1>
    <div class="subtitle">HARDCORE MODE</div>
    <button class="btn-start" id="startBtn">START MISSION</button>
  </div>
</div>

<script>
  const container = document.getElementById('gameContainer');
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d', { alpha: false });
  const scoreEl = document.getElementById('scoreEl');
  const bestEl = document.getElementById('bestEl');
  const overlay = document.getElementById('menuOverlay');
  const startBtn = document.getElementById('startBtn');
  const bossWarn = document.getElementById('bossWarn');

  // AUDIO
  let actx = null;
  function initAudio() {
    try {
      if (!actx) actx = new (window.AudioContext || window.webkitAudioContext)();
      if (actx.state === 'suspended') actx.resume();
    } catch(e) {}
  }
  function playSound(type) {
    if (!actx) return;
    try {
      const osc = actx.createOscillator();
      const gain = actx.createGain();
      osc.connect(gain); gain.connect(actx.destination);
      const now = actx.currentTime;
      
      if (type === 'laser') {
        osc.frequency.setValueAtTime(800, now); osc.frequency.exponentialRampToValueAtTime(100, now+0.1);
        gain.gain.setValueAtTime(0.05, now); gain.gain.linearRampToValueAtTime(0, now+0.1);
      } else if (type === 'boom') {
        osc.type='sawtooth'; osc.frequency.setValueAtTime(100, now); osc.frequency.exponentialRampToValueAtTime(10, now+0.3);
        gain.gain.setValueAtTime(0.2, now); gain.gain.linearRampToValueAtTime(0, now+0.3);
      } else if (type === 'warn') {
        osc.type='square'; osc.frequency.setValueAtTime(150, now);
        gain.gain.setValueAtTime(0.1, now); gain.gain.linearRampToValueAtTime(0, now+0.5);
      }
      osc.start(now); osc.stop(now+(type==='warn'?0.5:0.3));
    } catch(e) {}
  }

  function resize() {
    canvas.width = container.clientWidth;
    canvas.height = container.clientHeight;
  }
  window.addEventListener('resize', resize);
  setTimeout(resize, 100);

  // GAME VARS
  let player = { x: 0, y: 0 };
  let bullets = [];
  let enemyBullets = []; // Peluru musuh
  let enemies = [];
  let stars = [];
  let score = 0;
  let highScore = localStorage.getItem('extremeBest') || 0;
  let running = false;
  let frame = 0;
  let bossActive = false;
  let nextBossScore = 500;

  bestEl.innerText = highScore;
  const keys = { left: false, right: false, dash: false };

  // Init Stars
  for(let i=0; i<50; i++) stars.push({x:Math.random(), y:Math.random(), s:Math.random()*2, v:Math.random()+0.5});

  function startGame() {
    initAudio(); resize();
    player.x = canvas.width / 2;
    player.y = canvas.height - 180;
    bullets = []; enemyBullets = []; enemies = [];
    score = 0; running = true;
    bossActive = false; nextBossScore = 500;
    
    scoreEl.innerText = 0;
    overlay.classList.add('hidden');
    bossWarn.style.display = 'none';
    container.classList.remove('shake');
    loop();
  }

  function spawnBoss() {
    bossActive = true;
    playSound('warn');
    bossWarn.style.display = 'block';
    setTimeout(() => { bossWarn.style.display = 'none'; }, 2000);

    enemies.push({
      type: 'boss',
      x: canvas.width/2, y: -100,
      w: 100, h: 80,
      hp: 30 + (score/100), // Boss makin lama makin kuat
      dir: 1
    });
  }

  function update() {
    if (!running) return;
    frame++;

    // 1. Move Player
    let speed = keys.dash ? 9 : 5;
    if (keys.left) player.x -= speed;
    if (keys.right) player.x += speed;
    if (player.x < 20) player.x = 20;
    if (player.x > canvas.width - 20) player.x = canvas.width - 20;

    // 2. Auto Shoot
    if (frame % 12 === 0) {
      bullets.push({x: player.x, y: player.y - 20});
      playSound('laser');
    }

    // 3. Spawn Logic (Normal vs Boss)
    if (!bossActive) {
      if (score >= nextBossScore) {
        spawnBoss();
        nextBossScore += 500;
      } else if (frame % 50 === 0) {
        // Random Enemy Type
        let rand = Math.random();
        let type = 'normal';
        if (rand > 0.7) type = 'shooter'; // 30% musuh tembak
        if (rand > 0.9) type = 'chaser';  // 10% musuh kejar
        
        enemies.push({
          type: type,
          x: Math.random() * (canvas.width - 40) + 20,
          y: -40,
          s: 30, hp: type==='shooter'?3:1
        });
      }
    }

    // 4. Bullets Logic
    for (let i = bullets.length - 1; i >= 0; i--) {
      bullets[i].y -= 15;
      if (bullets[i].y < 0) bullets.splice(i, 1);
    }

    // 5. Enemy Bullets Logic
    for (let i = enemyBullets.length - 1; i >= 0; i--) {
      let eb = enemyBullets[i];
      eb.y += 6; // Peluru musuh turun
      eb.x += eb.vx || 0;
      
      // Hit Player?
      let dx = player.x - eb.x;
      let dy = player.y - eb.y;
      if (Math.sqrt(dx*dx + dy*dy) < 15) {
        gameOver();
      }
      if (eb.y > canvas.height) enemyBullets.splice(i, 1);
    }

    // 6. Enemies Logic
    for (let i = enemies.length - 1; i >= 0; i--) {
      let e = enemies[i];

      // Movement
      if (e.type === 'boss') {
        if (e.y < 80) e.y += 1; // Masuk skrin
        e.x += e.dir * 2; // Gerak kiri kanan
        if (e.x > canvas.width - 60 || e.x < 60) e.dir *= -1;
        
        // Boss Shoot
        if (frame % 40 === 0) {
          enemyBullets.push({x: e.x, y: e.y + 40, vx: 0}); // Tengah
          enemyBullets.push({x: e.x, y: e.y + 40, vx: -2}); // Kiri
          enemyBullets.push({x: e.x, y: e.y + 40, vx: 2}); // Kanan
        }

      } else if (e.type === 'chaser') {
        e.y += 4;
        if (e.x < player.x) e.x += 1; // Kejar player
        else e.x -= 1;
      } else {
        e.y += 3; // Normal speed
        if (e.type === 'shooter' && frame % 100 === 0) {
          enemyBullets.push({x: e.x, y: e.y, vx: 0});
        }
      }

      // Kena Tembak?
      for (let b = bullets.length - 1; b >= 0; b--) {
        let bull = bullets[b];
        let hitbox = e.type==='boss' ? 50 : 20;
        
        if (Math.abs(bull.x - e.x) < hitbox && Math.abs(bull.y - e.y) < hitbox) {
          bullets.splice(b, 1);
          e.hp--;
          if (e.hp <= 0) {
            playSound('boom');
            enemies.splice(i, 1);
            if(e.type==='boss') {
              score += 500;
              bossActive = false;
              container.classList.add('shake');
              setTimeout(()=>container.classList.remove('shake'), 500);
            } else {
              score += (e.type==='shooter'?50:20);
            }
            scoreEl.innerText = score;
          }
          break;
        }
      }

      // Langgar Player?
      let hitbox = e.type==='boss' ? 60 : 25;
      if (Math.abs(player.x - e.x) < hitbox && Math.abs(player.y - e.y) < hitbox) {
        gameOver();
      }

      if (e.y > canvas.height + 100) enemies.splice(i, 1);
    }
  }

  function draw() {
    ctx.fillStyle = "#050011"; ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Stars
    ctx.fillStyle = "#fff";
    stars.forEach(s => {
      s.y += s.v * (keys.dash?5:1); if(s.y > 1) s.y=0;
      ctx.beginPath(); ctx.arc(s.x*canvas.width, s.y*canvas.height, s.s, 0, Math.PI*2); ctx.fill();
    });

    if (running) {
      // Player
      ctx.save(); ctx.translate(player.x, player.y);
      ctx.fillStyle = "#fff";
      // Jet Shape
      ctx.beginPath(); ctx.moveTo(0,-25); ctx.lineTo(15,20); ctx.lineTo(0,10); ctx.lineTo(-15,20); ctx.fill();
      ctx.fillStyle = "#00ccff"; ctx.beginPath(); ctx.arc(0,-5, 4, 0, Math.PI*2); ctx.fill(); // cockpit
      if(keys.dash) { ctx.fillStyle="#ffaa00"; ctx.beginPath(); ctx.moveTo(-5,20); ctx.lineTo(0,40); ctx.lineTo(5,20); ctx.fill(); }
      ctx.restore();

      // Bullets (Player)
      ctx.fillStyle = "#ff0";
      bullets.forEach(b => ctx.fillRect(b.x-2, b.y-10, 4, 15));

      // Bullets (Enemy)
      ctx.fillStyle = "#f0f"; // Peluru musuh warna Ungu
      enemyBullets.forEach(b => {
        ctx.beginPath(); ctx.arc(b.x, b.y, 6, 0, Math.PI*2); ctx.fill();
      });

      // Enemies
      enemies.forEach(e => {
        ctx.save(); ctx.translate(e.x, e.y);
        
        if (e.type === 'boss') {
          // BOSS DRAWING
          ctx.fillStyle = "#aa0000";
          ctx.beginPath(); ctx.moveTo(0, 50); ctx.lineTo(50, -20); ctx.lineTo(20, -40); ctx.lineTo(-20, -40); ctx.lineTo(-50, -20); ctx.fill();
          // Boss Core
          ctx.fillStyle = "#ff0000"; ctx.beginPath(); ctx.arc(0, 0, 15 + Math.sin(frame*0.1)*5, 0, Math.PI*2); ctx.fill();
          // Health Bar
          ctx.fillStyle = "red"; ctx.fillRect(-40, -60, 80, 5);
          ctx.fillStyle = "#0f0"; ctx.fillRect(-40, -60, 80 * (e.hp/30), 5);
          
        } else if (e.type === 'shooter') {
          // SHOOTER DRAWING
          ctx.fillStyle = "#ff8800";
          ctx.beginPath(); ctx.moveTo(0, 15); ctx.lineTo(15, -15); ctx.lineTo(-15, -15); ctx.fill();
        } else {
          // BASIC/CHASER
          ctx.fillStyle = e.type==='chaser' ? "#ffff00" : "#ff4444";
          ctx.beginPath(); ctx.arc(0, 0, e.type==='chaser'?10:15, 0, Math.PI*2); ctx.fill();
        }
        ctx.restore();
      });
    }
  }

  function loop() { update(); draw(); if(running) requestAnimationFrame(loop); }

  function gameOver() {
    running = false; playSound('boom');
    if(score>highScore){ highScore=score; localStorage.setItem('extremeBest', highScore); bestEl.innerText=highScore; }
    overlay.classList.remove('hidden');
    document.querySelector('h1').innerHTML = "SYSTEM<br>DESTROYED";
    startBtn.innerText = "RETRY MISSION";
    container.classList.add('shake');
  }

  // CONTROLS
  const bindT = (id,k) => {
    let el = document.getElementById(id);
    el.addEventListener('touchstart', (e)=>{e.preventDefault(); keys[k]=true;});
    el.addEventListener('touchend', (e)=>{e.preventDefault(); keys[k]=false;});
    el.addEventListener('mousedown', ()=>{keys[k]=true;});
    el.addEventListener('mouseup', ()=>{keys[k]=false;});
  }
  bindT('zone-left','left'); bindT('zone-right','right'); bindT('btnDash','dash');
  startBtn.addEventListener('click', startGame);
  startBtn.addEventListener('touchstart', (e)=>{e.preventDefault(); startGame()});

  // PC Keys
  window.addEventListener('keydown', e=>{
    if(e.key==='ArrowLeft') keys.left=true; if(e.key==='ArrowRight') keys.right=true; if(e.code==='Space') keys.dash=true;
  });
  window.addEventListener('keyup', e=>{
    if(e.key==='ArrowLeft') keys.left=false; if(e.key==='ArrowRight') keys.right=false; if(e.code==='Space') keys.dash=false;
  });

  draw();
</script>
</body>
</html>
