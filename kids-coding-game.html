<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>GALACTIC DEFENDER</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@900&display=swap');

    * { box-sizing: border-box; touch-action: none; user-select: none; -webkit-tap-highlight-color: transparent; }
    
    body {
      margin: 0; padding: 0;
      background: #000;
      font-family: 'Orbitron', sans-serif;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      width: 100vw;
    }

    #gameContainer {
      position: relative;
      width: 100%;
      height: 100%;
      max-width: 500px;
      background: #0a0a1a;
      border-left: 2px solid #333;
      border-right: 2px solid #333;
      overflow: hidden;
    }

    canvas { display: block; width: 100%; height: 100%; z-index: 1; }

    /* UI */
    .hud {
      position: absolute; top: 20px; width: 100%;
      display: flex; justify-content: space-between; padding: 0 20px;
      z-index: 10; pointer-events: none;
    }
    .score-txt { color: #aaa; font-size: 12px; }
    .score-val { font-size: 20px; color: #00ffcc; text-shadow: 0 0 5px #00ffcc; }

    /* DASH BUTTON - Diletakkan jauh sikit dari kapal */
    .dash-wrapper {
      position: absolute; bottom: 30px; width: 100%;
      display: flex; justify-content: center; z-index: 20; pointer-events: auto;
    }
    .dash-btn {
      background: rgba(255, 0, 85, 0.2); 
      border: 2px solid #ff0055;
      color: #fff; padding: 15px 50px; border-radius: 4px;
      font-family: 'Orbitron', sans-serif; font-size: 18px; 
      letter-spacing: 2px; text-transform: uppercase;
      backdrop-filter: blur(4px);
    }
    .dash-btn:active { background: #ff0055; transform: scale(0.95); }

    /* MENU */
    .overlay {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.9);
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      z-index: 99;
    }
    .hidden { display: none !important; }

    h1 { 
      color: #00ffcc; font-size: 36px; text-align: center; margin-bottom: 10px; 
      text-shadow: 0 0 10px #00ffcc;
      line-height: 1.2;
    }
    
    .btn-start {
      background: #00ffcc; color: #000; border: none; padding: 15px 40px;
      font-family: 'Orbitron', sans-serif; font-size: 20px; font-weight: 900;
      clip-path: polygon(10% 0, 100% 0, 100% 70%, 90% 100%, 0 100%, 0 30%);
      cursor: pointer; margin-top: 30px;
    }
    
    .touch-zone { position: absolute; top: 0; height: 100%; width: 50%; z-index: 5; }
    #zone-left { left: 0; }
    #zone-right { right: 0; }
  </style>
</head>
<body>

<div id="gameContainer">
  <canvas id="gameCanvas"></canvas>
  
  <div id="zone-left" class="touch-zone"></div>
  <div id="zone-right" class="touch-zone"></div>

  <div class="hud">
    <div><div class="score-txt">SCORE</div><div class="score-val" id="scoreEl">0</div></div>
    <div style="text-align:right"><div class="score-txt">BEST</div><div class="score-val" id="bestEl">0</div></div>
  </div>

  <div class="dash-wrapper">
    <button class="dash-btn" id="btnDash">âš¡ BOOST</button>
  </div>

  <div class="overlay" id="menuOverlay">
    <h1>GALACTIC<br>DEFENDER</h1>
    <p style="color:#888; text-align:center; font-size:12px;">AUTO-SHOOT ENABLED</p>
    <button class="btn-start" id="startBtn">LAUNCH SHIP</button>
  </div>
</div>

<script>
  const container = document.getElementById('gameContainer');
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d', { alpha: false });
  const scoreEl = document.getElementById('scoreEl');
  const bestEl = document.getElementById('bestEl');
  const overlay = document.getElementById('menuOverlay');
  const startBtn = document.getElementById('startBtn');
  const btnDash = document.getElementById('btnDash');

  // AUDIO
  let actx = null;
  function initAudio() {
    try {
      if (!actx) actx = new (window.AudioContext || window.webkitAudioContext)();
      if (actx.state === 'suspended') actx.resume();
    } catch(e) {}
  }
  
  function playSound(type) {
    if (!actx) return;
    try {
      const osc = actx.createOscillator();
      const gain = actx.createGain();
      osc.connect(gain); gain.connect(actx.destination);
      const now = actx.currentTime;
      
      if (type === 'laser') {
        osc.frequency.setValueAtTime(800, now);
        osc.frequency.exponentialRampToValueAtTime(100, now+0.1);
        gain.gain.setValueAtTime(0.05, now);
        gain.gain.linearRampToValueAtTime(0, now+0.1);
        osc.start(now); osc.stop(now+0.1);
      } else if (type === 'boom') {
        osc.type = 'sawtooth';
        osc.frequency.setValueAtTime(100, now);
        osc.frequency.exponentialRampToValueAtTime(10, now+0.3);
        gain.gain.setValueAtTime(0.2, now);
        gain.gain.linearRampToValueAtTime(0, now+0.3);
        osc.start(now); osc.stop(now+0.3);
      }
    } catch(e) {}
  }

  function resize() {
    canvas.width = container.clientWidth;
    canvas.height = container.clientHeight;
  }
  window.addEventListener('resize', resize);
  setTimeout(resize, 100);

  // GAME STATE
  let player = { x: 0, y: 0, w: 40 };
  let bullets = [];
  let enemies = [];
  let stars = [];
  let score = 0;
  let highScore = localStorage.getItem('spaceBest') || 0;
  let running = false;
  let speed = 2; // Kelajuan background (forward movement)
  let frame = 0;

  bestEl.innerText = highScore;
  
  // Stars Background
  for(let i=0; i<40; i++) stars.push({
    x: Math.random(), y: Math.random(), 
    s: Math.random()*2, v: Math.random()*2+1
  });

  const keys = { left: false, right: false, dash: false };

  function startGame() {
    initAudio();
    resize();
    // SET POSISI KAPAL LEBIH TINGGI (SUPAYA TAK KENA BUTTON DASH)
    player.x = canvas.width / 2;
    player.y = canvas.height - 180; // <--- INI UBAH KEDUDUKAN
    
    bullets = [];
    enemies = [];
    score = 0;
    speed = 2;
    running = true;
    scoreEl.innerText = 0;
    overlay.classList.add('hidden');
    loop();
  }

  function update() {
    if (!running) return;
    frame++;
    speed = keys.dash ? 8 : 3; // Laju bila dash

    // 1. Move Player
    let moveSpeed = keys.dash ? 10 : 6;
    if (keys.left) player.x -= moveSpeed;
    if (keys.right) player.x += moveSpeed;
    if (player.x < 20) player.x = 20;
    if (player.x > canvas.width - 20) player.x = canvas.width - 20;

    // 2. Shooting (Auto) - Setiap 15 frame
    if (frame % 15 === 0) {
      bullets.push({x: player.x, y: player.y - 20});
      playSound('laser');
    }

    // 3. Bullets Move
    for (let i = bullets.length - 1; i >= 0; i--) {
      bullets[i].y -= 15; // Laju peluru
      if (bullets[i].y < 0) bullets.splice(i, 1);
    }

    // 4. Enemies Spawn
    if (frame % 60 === 0) { // Setiap 1 saat
      enemies.push({
        x: Math.random() * (canvas.width - 40) + 20,
        y: -50,
        s: 30 + Math.random() * 20, // size
        hp: 2
      });
    }

    // 5. Enemies Logic
    for (let i = enemies.length - 1; i >= 0; i--) {
      let e = enemies[i];
      e.y += speed + 2; // Musuh gerak ke bawah

      // Kena Tembak?
      for (let b = bullets.length - 1; b >= 0; b--) {
        let bull = bullets[b];
        // Jarak peluru ke musuh
        let dx = bull.x - e.x;
        let dy = bull.y - e.y;
        if (Math.sqrt(dx*dx + dy*dy) < e.s) {
          bullets.splice(b, 1); // Padam peluru
          e.hp--;
          if(e.hp <= 0) {
            playSound('boom');
            enemies.splice(i, 1); // Padam musuh
            score += 100;
            scoreEl.innerText = score;
          }
          break; // Stop check peluru lain
        }
      }

      // Langgar Player?
      let pdx = player.x - e.x;
      let pdy = player.y - e.y;
      if (Math.sqrt(pdx*pdx + pdy*pdy) < (e.s/2 + 15)) {
         gameOver();
      }

      // Keluar skrin
      if (e.y > canvas.height + 50) {
        enemies.splice(i, 1);
      }
    }
  }

  function drawJet(x, y) {
    ctx.save();
    ctx.translate(x, y);
    
    // Warna Asas
    ctx.fillStyle = "#fff";
    
    // Sayap Kiri
    ctx.beginPath();
    ctx.moveTo(-10, 0); ctx.lineTo(-30, 20); ctx.lineTo(-10, 20);
    ctx.fill();
    
    // Sayap Kanan
    ctx.beginPath();
    ctx.moveTo(10, 0); ctx.lineTo(30, 20); ctx.lineTo(10, 20);
    ctx.fill();
    
    // Badan Utama (Fuselage)
    ctx.fillStyle = "#ddd";
    ctx.beginPath();
    ctx.moveTo(0, -30); // Muncung
    ctx.lineTo(12, 25); // Ekor kanan
    ctx.lineTo(0, 15);  // Tengah ekor
    ctx.lineTo(-12, 25); // Ekor kiri
    ctx.fill();

    // Kokpit (Kaca Biru)
    ctx.fillStyle = "#00ccff";
    ctx.beginPath();
    ctx.moveTo(0, -10);
    ctx.ellipse(0, -5, 4, 8, 0, 0, Math.PI*2);
    ctx.fill();

    // Api Enjin
    if (keys.dash) {
       ctx.fillStyle = "#ffaa00";
       ctx.beginPath();
       ctx.moveTo(-5, 25); ctx.lineTo(0, 50); ctx.lineTo(5, 25);
       ctx.fill();
    }

    ctx.restore();
  }

  function draw() {
    // Clear Background
    ctx.fillStyle = "#050011";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Bintang (Effect Bergerak Ke Depan)
    ctx.fillStyle = "#fff";
    stars.forEach(s => {
      s.y += s.v * (keys.dash ? 4 : 1);
      if(s.y > 1) s.y = 0; // Reset ke atas
      
      let px = s.x * canvas.width;
      let py = s.y * canvas.height;
      
      ctx.beginPath();
      ctx.arc(px, py, keys.dash ? 1 : s.s, 0, Math.PI*2);
      ctx.fill();
      
      // Garisan laju (Warp effect)
      if(keys.dash) {
        ctx.strokeStyle = "rgba(255,255,255,0.3)";
        ctx.beginPath(); ctx.moveTo(px, py); ctx.lineTo(px, py-20); ctx.stroke();
      }
    });

    if (running) {
      // Draw Player Jet
      drawJet(player.x, player.y);

      // Draw Bullets
      ctx.fillStyle = "#ff0";
      bullets.forEach(b => {
        ctx.fillRect(b.x - 2, b.y - 10, 4, 15);
      });

      // Draw Enemies (Asteroid Merah)
      ctx.fillStyle = "#ff4444";
      ctx.strokeStyle = "#aa0000";
      ctx.lineWidth = 3;
      enemies.forEach(e => {
        ctx.beginPath();
        ctx.arc(e.x, e.y, e.s/2, 0, Math.PI*2);
        ctx.fill(); ctx.stroke();
        // Shine
        ctx.fillStyle = "rgba(255,255,255,0.2)";
        ctx.beginPath(); ctx.arc(e.x - 5, e.y - 5, e.s/4, 0, Math.PI*2); ctx.fill();
        ctx.fillStyle = "#ff4444"; // Reset
      });
    }
  }

  function loop() {
    update();
    draw();
    if (running) requestAnimationFrame(loop);
  }

  function gameOver() {
    running = false;
    playSound('boom');
    if (score > highScore) {
      highScore = score;
      localStorage.setItem('spaceBest', highScore);
      bestEl.innerText = highScore;
    }
    overlay.classList.remove('hidden');
    document.querySelector('h1').innerHTML = "MISSION<br>FAILED";
    startBtn.innerText = "RETRY MISSION";
  }

  // CONTROLS
  const bindTouch = (id, k) => {
    const el = document.getElementById(id);
    el.addEventListener('touchstart', (e)=>{e.preventDefault(); keys[k]=true;});
    el.addEventListener('touchend', (e)=>{e.preventDefault(); keys[k]=false;});
    el.addEventListener('mousedown', ()=>{keys[k]=true;});
    el.addEventListener('mouseup', ()=>{keys[k]=false;});
  };
  bindTouch('zone-left', 'left');
  bindTouch('zone-right', 'right');
  bindTouch('btnDash', 'dash');

  startBtn.addEventListener('click', startGame);
  startBtn.addEventListener('touchstart', (e)=>{e.preventDefault(); startGame()});

  // PC Keys
  window.addEventListener('keydown', (e) => {
    if(e.key==='ArrowLeft') keys.left=true;
    if(e.key==='ArrowRight') keys.right=true;
    if(e.code==='Space') keys.dash=true;
  });
  window.addEventListener('keyup', (e) => {
    if(e.key==='ArrowLeft') keys.left=false;
    if(e.key==='ArrowRight') keys.right=false;
    if(e.code==='Space') keys.dash=false;
  });

  draw(); // Static frame
</script>
</body>
</html>
