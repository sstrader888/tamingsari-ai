<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>NEON DODGE: LITE</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap');

    /* RESET & OPTIMIZATION */
    * { box-sizing: border-box; touch-action: none; user-select: none; -webkit-tap-highlight-color: transparent; }
    
    body {
      margin: 0; padding: 0;
      background: #000;
      font-family: 'Orbitron', sans-serif;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      width: 100vw;
    }

    /* GAME CONTAINER */
    #gameContainer {
      position: relative;
      width: 100%;
      height: 100%;
      max-width: 480px; 
      background: #050011; /* Solid color, no gradient for speed */
      border-left: 1px solid #333;
      border-right: 1px solid #333;
    }

    canvas { display: block; width: 100%; height: 100%; z-index: 1; }

    /* UI ELEMENTS */
    .hud {
      position: absolute; top: 30px; width: 100%;
      display: flex; justify-content: space-between; padding: 0 25px;
      z-index: 10; pointer-events: none;
    }
    .score-box { color: #fff; font-size: 14px; }
    .score-val { font-size: 24px; color: #00f3ff; font-weight: 900; }

    /* BUTTONS - SIMPLE DESIGN (NO GLOW) */
    .dash-wrapper {
      position: absolute; bottom: 60px; width: 100%;
      display: flex; justify-content: center; z-index: 20; pointer-events: auto;
    }
    .dash-btn {
      background: #ff0055; 
      border: 2px solid #fff;
      color: #fff; padding: 15px 60px; border-radius: 8px;
      font-family: 'Orbitron', sans-serif; font-size: 18px; font-weight: 900;
      text-transform: uppercase;
      /* Tiada box-shadow heavy */
    }
    .dash-btn:active { transform: scale(0.95); opacity: 0.8; }

    /* MENU - NO BLUR */
    .overlay {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.95); /* Solid dark */
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      z-index: 999;
    }
    .hidden { display: none !important; }

    h1 { color: #00f3ff; font-size: 40px; margin: 0; text-align: center; margin-bottom: 20px; }
    
    .btn-start {
      background: #00f3ff; color: #000; border: none; padding: 20px 60px;
      font-family: 'Orbitron', sans-serif; font-size: 20px; font-weight: 900;
      cursor: pointer; margin-top: 20px;
    }
    .btn-start:active { transform: scale(0.95); }

    .touch-zone { position: absolute; top: 0; height: 100%; width: 50%; z-index: 5; }
    #zone-left { left: 0; }
    #zone-right { right: 0; }
  </style>
</head>
<body>

<div id="gameContainer">
  <canvas id="gameCanvas"></canvas>
  
  <div id="zone-left" class="touch-zone"></div>
  <div id="zone-right" class="touch-zone"></div>

  <div class="hud">
    <div>SCORE<br><span class="score-val" id="scoreEl">0</span></div>
    <div style="text-align:right">BEST<br><span class="score-val" id="bestEl">0</span></div>
  </div>

  <div class="dash-wrapper">
    <button class="dash-btn" id="btnDash">âš¡ DASH</button>
  </div>

  <div class="overlay" id="menuOverlay">
    <h1>NEON<br>LITE</h1>
    <p style="color:#aaa; text-align:center;">PERFORMANCE MODE</p>
    <button class="btn-start" id="startBtn">START</button>
  </div>
</div>

<script>
  // SETUP
  const container = document.getElementById('gameContainer');
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d', { alpha: false }); // Optimization flag
  const scoreEl = document.getElementById('scoreEl');
  const bestEl = document.getElementById('bestEl');
  const overlay = document.getElementById('menuOverlay');
  const startBtn = document.getElementById('startBtn');
  const btnDash = document.getElementById('btnDash');

  // AUDIO (SAFE)
  let actx = null;
  function initAudio() {
    try {
      if (!actx) { actx = new (window.AudioContext || window.webkitAudioContext)(); }
      if (actx.state === 'suspended') actx.resume();
    } catch(e) {}
  }
  function playTone(freq, type) {
    if (!actx) return;
    try {
      const osc = actx.createOscillator();
      const gain = actx.createGain();
      osc.connect(gain); gain.connect(actx.destination);
      osc.type = type;
      osc.frequency.setValueAtTime(freq, actx.currentTime);
      gain.gain.setValueAtTime(0.1, actx.currentTime);
      gain.gain.linearRampToValueAtTime(0, actx.currentTime + 0.1);
      osc.start(); osc.stop(actx.currentTime + 0.1);
    } catch(e) {}
  }

  // RESIZE
  function resize() {
    canvas.width = container.clientWidth;
    canvas.height = container.clientHeight;
  }
  window.addEventListener('resize', resize);
  setTimeout(resize, 100);

  // GAME VARS
  let player = { x: 0, y: 0 };
  let rocks = [];
  let score = 0;
  let highScore = localStorage.getItem('neonBest') || 0;
  let running = false;
  let speed = 1;
  let gridY = 0;
  bestEl.innerText = highScore;

  const keys = { left: false, right: false, dash: false };

  function startGame() {
    initAudio();
    resize();
    player.x = canvas.width / 2;
    player.y = canvas.height - 100;
    rocks = [];
    score = 0;
    speed = 1;
    running = true;
    scoreEl.innerText = 0;
    overlay.classList.add('hidden');
    playTone(600, 'sine');
    loop();
  }

  function update() {
    if (!running) return;

    // Movement
    let ms = keys.dash ? 12 : 7;
    if (keys.left) player.x -= ms;
    if (keys.right) player.x += ms;

    // Clamp
    if (player.x < 15) player.x = 15;
    if (player.x > canvas.width - 15) player.x = canvas.width - 15;

    // Grid Loop
    gridY += 3 * speed;
    if (gridY > 40) gridY = 0;

    // Spawn Rocks (Less frequent for performance)
    if (Math.random() < 0.02 * speed) {
      rocks.push({
        x: Math.random() * (canvas.width - 30),
        y: -50,
        s: 30 + Math.random() * 20,
        vy: (5 + Math.random() * 2) * speed
      });
    }

    // Rocks Logic
    for (let i = rocks.length - 1; i >= 0; i--) {
      let r = rocks[i];
      r.y += r.vy;

      // Simple Box Collision (Faster than circle)
      if (
        player.x < r.x + r.s &&
        player.x + 20 > r.x &&
        player.y < r.y + r.s &&
        player.y + 20 > r.y
      ) {
        gameOver();
      }

      if (r.y > canvas.height + 50) {
        rocks.splice(i, 1);
        score += 10;
        scoreEl.innerText = score;
        speed += 0.001;
      }
    }
  }

  function draw() {
    // 1. CLEAR (Solid color is fastest)
    ctx.fillStyle = '#050011';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // 2. GRID (Simple Lines, No Glow)
    ctx.strokeStyle = '#330044'; // Dark purple
    ctx.lineWidth = 2;
    ctx.beginPath();
    
    // Vertical lines
    let cx = canvas.width / 2;
    for (let i = -6; i <= 6; i++) {
        let x = cx + (i * 60);
        ctx.moveTo(x, 0); ctx.lineTo((x - cx) * 3 + cx, canvas.height);
    }
    // Horizontal lines
    for (let i = 0; i < canvas.height; i += 40) {
        let y = i + gridY;
        if(y > canvas.height) y -= canvas.height;
        ctx.moveTo(0, y); ctx.lineTo(canvas.width, y);
    }
    ctx.stroke();

    if (running) {
      // 3. PLAYER (Simple Triangle)
      ctx.fillStyle = keys.dash ? '#fff' : '#00f3ff';
      ctx.beginPath();
      ctx.moveTo(player.x, player.y - 20);
      ctx.lineTo(player.x + 15, player.y + 20);
      ctx.lineTo(player.x - 15, player.y + 20);
      ctx.fill();

      // 4. ROCKS (Hollow Boxes)
      ctx.strokeStyle = '#ff0055';
      ctx.lineWidth = 3;
      rocks.forEach(r => {
        ctx.strokeRect(r.x, r.y, r.s, r.s);
      });
    }
  }

  function loop() {
    update();
    draw();
    if (running) requestAnimationFrame(loop);
  }

  function gameOver() {
    running = false;
    playTone(150, 'sawtooth');
    if (score > highScore) {
      highScore = score;
      localStorage.setItem('neonBest', highScore);
      bestEl.innerText = highScore;
    }
    overlay.classList.remove('hidden');
    document.querySelector('h1').innerText = "GAME OVER";
    startBtn.innerText = "RETRY";
  }

  // CONTROLS
  const bindTouch = (elem, key) => {
    elem.addEventListener('touchstart', (e) => { e.preventDefault(); keys[key] = true; });
    elem.addEventListener('touchend', (e) => { e.preventDefault(); keys[key] = false; });
  };
  bindTouch(document.getElementById('zone-left'), 'left');
  bindTouch(document.getElementById('zone-right'), 'right');
  bindTouch(btnDash, 'dash');
  
  startBtn.addEventListener('click', startGame);
  startBtn.addEventListener('touchstart', (e)=>{e.preventDefault(); startGame()});

  // PC Keys
  window.addEventListener('keydown', (e) => {
    if(e.key==='ArrowLeft') keys.left=true;
    if(e.key==='ArrowRight') keys.right=true;
    if(e.code==='Space') keys.dash=true;
    if(!running && e.code==='Space') startGame();
  });
  window.addEventListener('keyup', (e) => {
    if(e.key==='ArrowLeft') keys.left=false;
    if(e.key==='ArrowRight') keys.right=false;
    if(e.code==='Space') keys.dash=false;
  });

  // Init
  draw();
</script>
</body>
</html>
