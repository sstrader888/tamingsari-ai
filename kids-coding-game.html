<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>GALACTIC WARFARE: ARSENAL</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700&display=swap');

  * { box-sizing: border-box; touch-action: none; user-select: none; -webkit-tap-highlight-color: transparent; }
  
  body {
    margin: 0; padding: 0; background: #000;
    font-family: 'Rajdhani', sans-serif;
    overflow: hidden; display: flex; align-items: center; justify-content: center;
    height: 100vh; width: 100vw;
  }

  #gameContainer {
    position: relative; width: 100%; height: 100%; max-width: 550px;
    background: #020205; 
    border-left: 2px solid #333; border-right: 2px solid #333;
    overflow: hidden;
    box-shadow: 0 0 50px rgba(0,0,0,0.8);
  }

  canvas { display: block; width: 100%; height: 100%; z-index: 1; }

  /* UI HUD */
  .hud {
    position: absolute; top: 10px; left: 0; width: 100%;
    padding: 10px 15px; z-index: 10; pointer-events: none;
    display: flex; flex-direction: column; gap: 5px;
  }

  .top-row { display: flex; justify-content: space-between; align-items: center; }
  .pilot-name { color: #00eaff; font-size: 14px; font-weight: bold; letter-spacing: 1px; }
  .score-disp { color: #fff; font-size: 20px; font-weight: bold; text-shadow: 0 0 10px #00eaff; }
  
  .bars-row { display: flex; gap: 10px; align-items: center; width: 100%; }
  
  /* HP BAR */
  .hp-box { width: 100px; height: 8px; background: #330000; border: 1px solid #ff0000; border-radius: 4px; overflow: hidden; }
  .hp-fill { height: 100%; width: 100%; background: #ff0000; transition: width 0.2s; }

  /* XP BAR */
  .xp-box { flex: 1; height: 8px; background: #002200; border: 1px solid #00ff00; border-radius: 4px; overflow: hidden; }
  .xp-fill { height: 100%; width: 0%; background: #00ff00; transition: width 0.2s; }
  .lvl-txt { color: #00ff00; font-weight: bold; font-size: 14px; margin-left: 5px; }

  /* NOTIFICATIONS */
  .center-notif {
    position: absolute; top: 35%; width: 100%; text-align: center;
    font-size: 32px; font-weight: 900; z-index: 15;
    opacity: 0; transform: scale(0.5); pointer-events: none;
    text-shadow: 0 0 20px rgba(255,255,255,0.5);
  }
  .anim-pop { animation: popScale 2s forwards; }

  @keyframes popScale {
    0% { opacity: 0; transform: scale(0.5); }
    10% { opacity: 1; transform: scale(1.2); }
    80% { opacity: 1; transform: scale(1); }
    100% { opacity: 0; transform: scale(1.5); }
  }

  /* BUTTONS */
  .controls-area {
    position: absolute; bottom: 20px; width: 100%;
    display: flex; justify-content: center; z-index: 20; pointer-events: auto;
  }
  .boost-btn {
    background: rgba(0, 200, 255, 0.1); border: 1px solid rgba(0, 200, 255, 0.5);
    color: #fff; padding: 15px 60px; border-radius: 30px;
    font-family: 'Rajdhani', sans-serif; font-size: 18px; font-weight: bold;
    backdrop-filter: blur(5px); transition: 0.1s;
  }
  .boost-btn:active { background: rgba(0, 200, 255, 0.4); transform: scale(0.95); }

  /* SCREENS */
  .overlay {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(2, 2, 8, 0.96);
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    z-index: 100; transition: opacity 0.3s;
  }
  .hidden { opacity: 0; pointer-events: none; }

  h1 { color: #fff; font-size: 42px; text-align: center; margin: 0; text-shadow: 0 0 20px #00eaff; line-height: 1; margin-bottom: 10px; }
  .sub { color: #888; letter-spacing: 4px; font-size: 14px; margin-bottom: 30px; text-transform: uppercase;}

  input {
    background: rgba(255,255,255,0.1); border: 1px solid #444; color: #fff;
    padding: 10px 20px; font-size: 18px; text-align: center; border-radius: 5px;
    font-family: 'Rajdhani', sans-serif; margin-bottom: 20px; width: 200px;
  }
  input:focus { outline: none; border-color: #00eaff; }

  .btn-main {
    background: linear-gradient(135deg, #00eaff, #0088ff); color: #000;
    border: none; padding: 12px 50px; font-size: 20px; font-weight: bold;
    clip-path: polygon(10% 0, 100% 0, 100% 70%, 90% 100%, 0 100%, 0 30%);
    cursor: pointer; font-family: 'Rajdhani', sans-serif;
  }
  .btn-main:hover { filter: brightness(1.2); }

  .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; text-align: center; }
  .stat-box h3 { color: #888; font-size: 12px; margin: 0; }
  .stat-box p { color: #fff; font-size: 24px; margin: 5px 0 0 0; font-weight: bold; }

  .touch-zone { position: absolute; top: 0; height: 100%; width: 50%; z-index: 5; }
  #zone-left { left: 0; }
  #zone-right { right: 0; }

</style>
</head>
<body>

<div id="gameContainer">
  <canvas id="gameCanvas"></canvas>
  <div id="zone-left" class="touch-zone"></div>
  <div id="zone-right" class="touch-zone"></div>

  <div class="hud" id="hud" style="opacity:0">
    <div class="top-row">
      <div class="pilot-name" id="pilotNameDisp">PILOT</div>
      <div class="score-disp" id="scoreDisp">0</div>
    </div>
    <div class="bars-row">
      <div class="hp-box"><div class="hp-fill" id="hpBar"></div></div>
      <div class="xp-box"><div class="xp-fill" id="xpBar"></div></div>
      <div class="lvl-txt" id="lvlDisp">LVL 1</div>
    </div>
  </div>

  <div class="center-notif" id="notif">LEVEL UP!</div>

  <div class="controls-area">
    <button class="boost-btn" id="btnDash">BOOST</button>
  </div>

  <div class="overlay" id="loginScreen">
    <h1>GALACTIC<br><span style="color:#00eaff">ARSENAL</span></h1>
    <div class="sub">ENTER PILOT ID</div>
    <input type="text" id="nameInput" placeholder="NAME" maxlength="10">
    <button class="btn-main" id="btnLogin">LAUNCH</button>
  </div>

  <div class="overlay hidden" id="gameOverScreen">
    <h1 style="color:#ff3333; text-shadow:0 0 20px #ff0000">SYSTEM<br>CRITICAL</h1>
    <div class="stats-grid">
      <div class="stat-box"><h3>SCORE</h3><p id="finalScore">0</p></div>
      <div class="stat-box"><h3>LEVEL</h3><p id="finalLevel">1</p></div>
    </div>
    <button class="btn-main" id="btnRetry">REBOOT</button>
  </div>
</div>

<script>
  // --- CONFIG ---
  const container = document.getElementById('gameContainer');
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d', { alpha: false });
  
  // UI Elements
  const hud = document.getElementById('hud');
  const pilotNameDisp = document.getElementById('pilotNameDisp');
  const scoreDisp = document.getElementById('scoreDisp');
  const hpBar = document.getElementById('hpBar');
  const xpBar = document.getElementById('xpBar');
  const lvlDisp = document.getElementById('lvlDisp');
  const notif = document.getElementById('notif');
  
  const loginScreen = document.getElementById('loginScreen');
  const nameInput = document.getElementById('nameInput');
  const btnLogin = document.getElementById('btnLogin');
  const gameOverScreen = document.getElementById('gameOverScreen');
  const btnRetry = document.getElementById('btnRetry');
  const finalScore = document.getElementById('finalScore');
  const finalLevel = document.getElementById('finalLevel');
  const btnDash = document.getElementById('btnDash');

  // AUDIO
  let actx = null;
  function initAudio() { try { if(!actx) actx = new (window.AudioContext||window.webkitAudioContext)(); if(actx.state==='suspended') actx.resume(); } catch(e){} }
  function sfx(type) {
    if(!actx) return;
    const o = actx.createOscillator(); const g = actx.createGain();
    o.connect(g); g.connect(actx.destination);
    const t = actx.currentTime;
    
    if(type==='shoot'){ o.frequency.setValueAtTime(600,t); o.frequency.exponentialRampToValueAtTime(200,t+0.1); g.gain.setValueAtTime(0.05,t); g.gain.linearRampToValueAtTime(0,t+0.1); }
    if(type==='laser'){ o.type='triangle'; o.frequency.setValueAtTime(1200,t); o.frequency.exponentialRampToValueAtTime(400,t+0.2); g.gain.setValueAtTime(0.05,t); g.gain.linearRampToValueAtTime(0,t+0.2); }
    if(type==='boom'){ o.type='sawtooth'; o.frequency.setValueAtTime(100,t); o.frequency.exponentialRampToValueAtTime(10,t+0.3); g.gain.setValueAtTime(0.2,t); g.gain.linearRampToValueAtTime(0,t+0.3); }
    if(type==='power'){ o.type='sine'; o.frequency.setValueAtTime(400,t); o.frequency.linearRampToValueAtTime(800,t+0.3); g.gain.setValueAtTime(0.1,t); g.gain.linearRampToValueAtTime(0,t+0.3); }
    o.start(t); o.stop(t+0.4);
  }

  // RESIZE
  function resize() { canvas.width = container.clientWidth; canvas.height = container.clientHeight; }
  window.addEventListener('resize', resize); setTimeout(resize, 100);

  // --- VARIABLES ---
  let pilotName = localStorage.getItem('gw_pilot') || "";
  if(pilotName) nameInput.value = pilotName;

  let animationId = null; // Loop Control
  let state = 'LOGIN';
  let frame = 0;
  let score = 0;
  
  let level = 1;
  let xp = 0;
  let xpToNext = 200;
  
  let player = { x:0, y:0, hp:100, maxHp:100, weaponType:'SPREAD', shield:0 }; // Weapon: SPREAD, LASER
  
  let bullets = [];
  let enemies = [];
  let particles = [];
  let powerups = [];
  let stars = [];
  let planetY = -200;
  let bossActive = false;

  const keys = { left:false, right:false, dash:false };

  for(let i=0; i<60; i++) stars.push({ x:Math.random(), y:Math.random(), s:Math.random()*2, v:Math.random()*0.5+0.2 });

  // --- LOGIC ---
  function login() {
    let name = nameInput.value.toUpperCase().trim() || "PILOT";
    pilotName = name;
    localStorage.setItem('gw_pilot', pilotName);
    loginScreen.classList.add('hidden');
    startGame();
  }

  function startGame() {
    initAudio(); resize();
    if(animationId) { cancelAnimationFrame(animationId); animationId = null; }
    
    state = 'PLAYING';
    frame = 0; score = 0; level = 1; xp = 0; xpToNext = 200;
    
    player = { x: canvas.width/2, y: canvas.height-120, hp:100, maxHp:100, weaponType:'SPREAD', shield:0 };
    bossActive = false;
    
    bullets=[]; enemies=[]; particles=[]; powerups=[];
    
    hud.style.opacity = 1;
    pilotNameDisp.innerText = pilotName;
    updateHUD();
    
    gameOverScreen.classList.add('hidden');
    loop();
  }

  function showNotif(text, color) {
    notif.innerText = text;
    notif.style.color = color;
    notif.classList.remove('anim-pop');
    void notif.offsetWidth; // Trigger reflow
    notif.classList.add('anim-pop');
  }

  function addXP(amount) {
    xp += amount; score += amount;
    if(xp >= xpToNext) {
      xp = 0; level++; xpToNext = Math.floor(xpToNext * 1.3);
      showNotif("LEVEL " + level, "#00ff00");
      sfx('power');
      // Boss Check
      if(level % 5 === 0) spawnBoss();
    }
    updateHUD();
  }

  function updateHUD() {
    scoreDisp.innerText = score;
    lvlDisp.innerText = "LVL " + level;
    xpBar.style.width = (xp / xpToNext) * 100 + "%";
    hpBar.style.width = (player.hp / player.maxHp) * 100 + "%";
  }

  function spawnBoss() {
    bossActive = true;
    showNotif("BOSS INCOMING!", "#ff0000");
    enemies.push({
      type: 'boss', x: canvas.width/2, y: -150,
      w: 120, h: 80, hp: 100 * level, maxHp: 100 * level,
      vx: 2, vy: 1
    });
  }

  function spawnPowerup(x, y) {
    const types = ['S', 'L', 'B', 'H'];
    const rand = types[Math.floor(Math.random() * types.length)];
    powerups.push({ x:x, y:y, type:rand });
  }

  function update() {
    if(state !== 'PLAYING') return;
    frame++;

    // Player Move
    let speed = keys.dash ? 9 : 5;
    if(keys.left) player.x -= speed;
    if(keys.right) player.x += speed;
    if(player.x < 25) player.x = 25; if(player.x > canvas.width-25) player.x = canvas.width-25;
    
    if(player.shield > 0) player.shield--;

    // Shooting
    if(frame % 10 === 0) {
      if(player.weaponType === 'SPREAD') {
        bullets.push({x:player.x, y:player.y-30, vx:0, vy:-15, c:'#ffff00', w:4});
        bullets.push({x:player.x, y:player.y-30, vx:-3, vy:-13, c:'#ffff00', w:4});
        bullets.push({x:player.x, y:player.y-30, vx:3, vy:-13, c:'#ffff00', w:4});
        sfx('shoot');
      } else if (player.weaponType === 'LASER') {
        bullets.push({x:player.x, y:player.y-30, vx:0, vy:-25, c:'#ff0000', w:8, dmg:5}); // Laju & Kuat
        sfx('laser');
      }
    }

    // Bullets Move
    for(let i=bullets.length-1; i>=0; i--) {
      let b = bullets[i];
      b.x += b.vx; b.y += b.vy;
      if(b.y < -20) bullets.splice(i,1);
    }

    // Spawn Enemy
    if(!bossActive && frame % (Math.max(20, 60-level)) === 0) {
      let rand = Math.random();
      let type = 'basic';
      if(rand > 0.7) type = 'zigzag';
      if(rand > 0.85) type = 'kamikaze';
      if(rand > 0.95) type = 'tank';

      let size = 30;
      let hp = 1 + Math.floor(level/2);
      let speed = 2 + (level*0.1);

      if(type==='tank') { size=50; hp*=3; speed*=0.5; }
      if(type==='kamikaze') { speed*=2; }

      enemies.push({
        type: type, x: Math.random()*(canvas.width-60)+30, y: -50,
        w: size, hp: hp, s: speed, frameOffset: Math.random()*100
      });
    }

    // Enemy Logic
    for(let i=enemies.length-1; i>=0; i--) {
      let e = enemies[i];
      
      if(e.type === 'boss') {
        if(e.y < 100) e.y += 1;
        e.x += e.vx;
        if(e.x > canvas.width-60 || e.x < 60) e.vx *= -1;
      } else if (e.type === 'zigzag') {
        e.y += e.s;
        e.x += Math.sin((frame + e.frameOffset) * 0.1) * 3;
      } else if (e.type === 'kamikaze') {
        e.y += e.s;
        if(e.x < player.x) e.x += 1; else e.x -= 1;
      } else {
        e.y += e.s;
      }

      // Collision Player
      if(Math.abs(e.x - player.x) < (e.w/2 + 20) && Math.abs(e.y - player.y) < 40) {
        if(player.shield <= 0) {
          player.hp -= 20;
          updateHUD();
          sfx('boom');
          enemies.splice(i,1);
          if(player.hp <= 0) gameOver();
        } else {
          enemies.splice(i,1); // Shield kills enemy
          sfx('boom');
        }
      }

      // Collision Bullet
      for(let j=bullets.length-1; j>=0; j--) {
        let b = bullets[j];
        if(Math.abs(b.x - e.x) < e.w/2 && Math.abs(b.y - e.y) < e.w/2) {
          e.hp -= (b.dmg || 1);
          bullets.splice(j,1);
          
          // Spark
          particles.push({x:b.x, y:b.y, vx:(Math.random()-0.5)*5, vy:(Math.random()-0.5)*5, life:5, c:'#fff'});

          if(e.hp <= 0) {
            if(Math.random() < 0.2) spawnPowerup(e.x, e.y); // 20% drop rate
            addXP(e.type==='boss' ? 1000 : 20);
            
            if(e.type==='boss') {
                bossActive = false;
                showNotif("BOSS DEFEATED!", "#ffff00");
                // Big Explosion
                for(let k=0; k<30; k++) particles.push({x:e.x, y:e.y, vx:(Math.random()-0.5)*15, vy:(Math.random()-0.5)*15, life:40, c:'#f00'});
            }

            sfx('boom');
            enemies.splice(i,1);
          }
          break;
        }
      }
      if(e.y > canvas.height+50) enemies.splice(i,1);
    }

    // Powerups
    for(let i=powerups.length-1; i>=0; i--) {
      let p = powerups[i];
      p.y += 3;
      if(Math.abs(p.x - player.x) < 30 && Math.abs(p.y - player.y) < 30) {
        if(p.type === 'S') { player.weaponType = 'SPREAD'; showNotif("SPREAD SHOT!", "#ffff00"); }
        if(p.type === 'L') { player.weaponType = 'LASER'; showNotif("LASER BEAM!", "#ff0000"); }
        if(p.type === 'B') { player.shield = 300; showNotif("SHIELD UP!", "#00ccff"); } // 5 sec (60fps)
        if(p.type === 'H') { player.hp = Math.min(100, player.hp+30); updateHUD(); showNotif("REPAIR!", "#ff00ff"); }
        
        sfx('power');
        powerups.splice(i,1);
      }
      if(p.y > canvas.height) powerups.splice(i,1);
    }

    // Particles
    for(let i=particles.length-1; i>=0; i--) {
      let p = particles[i];
      p.x += p.vx; p.y += p.vy; p.life--;
      if(p.life <= 0) particles.splice(i,1);
    }

    planetY += 0.2; if(planetY > canvas.height + 200) planetY = -200;
  }

  function draw() {
    ctx.fillStyle = "#020205"; ctx.fillRect(0,0,canvas.width,canvas.height);

    // Stars
    ctx.fillStyle = "#fff";
    stars.forEach(s => {
      s.y += s.v * (keys.dash?4:1); if(s.y>1) s.y=0;
      ctx.globalAlpha = Math.random();
      ctx.beginPath(); ctx.arc(s.x*canvas.width, s.y*canvas.height, s.s, 0, Math.PI*2); ctx.fill();
    });
    ctx.globalAlpha = 1;

    // Planet
    ctx.save();
    let gradP = ctx.createRadialGradient(canvas.width*0.2, planetY, 10, canvas.width*0.2, planetY, 120);
    gradP.addColorStop(0, "#440044"); gradP.addColorStop(1, "transparent");
    ctx.fillStyle = gradP; ctx.beginPath(); ctx.arc(canvas.width*0.2, planetY, 120, 0, Math.PI*2); ctx.fill();
    ctx.restore();

    if(state === 'PLAYING') {
      
      // Powerups
      powerups.forEach(p => {
        ctx.save(); ctx.translate(p.x, p.y);
        let c = '#fff';
        if(p.type==='S') c='#0f0'; if(p.type==='L') c='#f00'; if(p.type==='B') c='#0ff'; if(p.type==='H') c='#f0f';
        ctx.shadowBlur = 10; ctx.shadowColor = c; ctx.fillStyle = c;
        ctx.fillRect(-12, -12, 24, 24);
        ctx.fillStyle = "#000"; ctx.font="bold 16px Arial"; ctx.textAlign="center"; ctx.textBaseline="middle";
        ctx.fillText(p.type, 0, 2);
        ctx.restore();
      });

      // Player
      ctx.save(); ctx.translate(player.x, player.y);
      if(player.shield > 0) {
        ctx.strokeStyle = `rgba(0, 255, 255, ${Math.random()})`; ctx.lineWidth = 2;
        ctx.beginPath(); ctx.arc(0, 0, 40, 0, Math.PI*2); ctx.stroke();
      }
      
      // Ship Design
      let pGrad = ctx.createLinearGradient(-20, 0, 20, 0);
      pGrad.addColorStop(0, "#0055aa"); pGrad.addColorStop(0.5, "#aaccff"); pGrad.addColorStop(1, "#0055aa");
      ctx.fillStyle = "#222"; ctx.beginPath(); ctx.moveTo(0,-25); ctx.lineTo(-20,25); ctx.lineTo(20,25); ctx.fill(); // Wings
      ctx.fillStyle = pGrad; ctx.beginPath(); ctx.moveTo(0,-35); ctx.lineTo(8,20); ctx.lineTo(0,25); ctx.lineTo(-8,20); ctx.fill(); // Body
      
      if(keys.dash) {
        ctx.shadowBlur=20; ctx.shadowColor="#0ff"; ctx.fillStyle="#fff";
        ctx.beginPath(); ctx.moveTo(-5,25); ctx.lineTo(0,45); ctx.lineTo(5,25); ctx.fill();
      }
      ctx.restore();

      // Bullets
      bullets.forEach(b => {
        ctx.shadowBlur = 5; ctx.shadowColor = b.c; ctx.fillStyle = b.c;
        ctx.fillRect(b.x - (b.w/2), b.y - 10, b.w, 15);
      });
      ctx.shadowBlur = 0;

      // Enemies
      enemies.forEach(e => {
        ctx.save(); ctx.translate(e.x, e.y);
        
        if(e.type === 'boss') {
            ctx.fillStyle = "#550000"; ctx.fillRect(-e.w/2, -e.h/2, e.w, e.h);
            ctx.fillStyle = "#ff0000"; ctx.fillRect(-20, -20, 40, 40); // Core
            // HP Bar Boss
            ctx.fillStyle = "red"; ctx.fillRect(-e.w/2, -e.h/2 - 10, e.w, 5);
            ctx.fillStyle = "#0f0"; ctx.fillRect(-e.w/2, -e.h/2 - 10, e.w * (e.hp/e.maxHp), 5);
        } else {
            let c = '#aaa';
            if(e.type==='kamikaze') c='#ff8800'; if(e.type==='tank') c='#004400'; if(e.type==='zigzag') c='#aa00aa';
            ctx.fillStyle = c;
            ctx.beginPath(); ctx.arc(0,0, e.w/2, 0, Math.PI*2); ctx.fill();
            // Detail
            ctx.fillStyle = "rgba(0,0,0,0.3)"; ctx.beginPath(); ctx.arc(0,0, e.w/4, 0, Math.PI*2); ctx.fill();
        }
        ctx.restore();
      });

      // Particles
      particles.forEach(p => {
        ctx.fillStyle = p.c; ctx.fillRect(p.x, p.y, 3, 3);
      });
    }
  }

  function loop() {
    update();
    draw();
    animationId = requestAnimationFrame(loop);
  }

  function gameOver() {
    state = 'GAMEOVER';
    if(animationId) { cancelAnimationFrame(animationId); animationId = null; }
    
    hud.style.opacity = 0;
    gameOverScreen.classList.remove('hidden');
    finalScore.innerText = score;
    finalLevel.innerText = level;
    draw();
  }

  // --- INPUTS ---
  btnLogin.addEventListener('click', login);
  btnRetry.addEventListener('click', startGame);

  const bindT = (id,k) => {
    let el = document.getElementById(id);
    el.addEventListener('touchstart', (e)=>{e.preventDefault(); keys[k]=true;});
    el.addEventListener('touchend', (e)=>{e.preventDefault(); keys[k]=false;});
    el.addEventListener('mousedown', ()=>{keys[k]=true;});
    el.addEventListener('mouseup', ()=>{keys[k]=false;});
  }
  bindT('zone-left','left'); bindT('zone-right','right'); bindT('btnDash','dash');

  window.addEventListener('keydown', e=>{
    if(e.key==='ArrowLeft') keys.left=true; if(e.key==='ArrowRight') keys.right=true; if(e.code==='Space') keys.dash=true;
  });
  window.addEventListener('keyup', e=>{
    if(e.key==='ArrowLeft') keys.left=false; if(e.key==='ArrowRight') keys.right=false; if(e.code==='Space') keys.dash=false;
  });

  draw();

</script>
</body>
</html>
