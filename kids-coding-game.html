<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8" />
  <title>Kids Coding Game V2 - Robot Pintar</title>
  <style>
    :root {
      --bg-color: #e0f2fe;
      --panel-bg: #ffffff;
      --accent: #3b82f6;
      --success: #10b981;
      --danger: #ef4444;
      --text: #1f2937;
    }

    * {
      box-sizing: border-box;
      font-family: 'Segoe UI', sans-serif;
    }

    body {
      min-height: 100vh;
      margin: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: var(--bg-color);
      padding: 20px;
    }

    .header-bar {
      margin-bottom: 20px;
      text-align: center;
    }

    .level-badge {
      background: var(--accent);
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: bold;
      margin-bottom: 5px;
      display: inline-block;
    }

    .app {
      background: var(--panel-bg);
      border-radius: 20px;
      padding: 25px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      max-width: 1000px;
      width: 100%;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
    }

    /* Grid Area */
    .grid-container {
      display: flex;
      justify-content: center;
      align-items: center;
      background: #f3f4f6;
      border-radius: 15px;
      padding: 20px;
      border: 4px solid #dbeafe;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(5, 60px);
      grid-template-rows: repeat(5, 60px);
      gap: 6px;
    }

    .cell {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      position: relative;
    }

    .cell.goal {
      background: #d1fae5;
      border: 2px solid #34d399;
    }
    
    .cell.obstacle {
      background: #fee2e2;
      border: 2px solid #fca5a5;
    }

    /* Robot Styling */
    .robot {
      font-size: 32px;
      transition: transform 0.4s ease-in-out;
      /* Default facing East means 0 rotation if sprite points right. 
         Adjusted logic handles rotation in JS */
    }

    /* Control Panel */
    .panel {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .control-group {
      background: #f9fafb;
      padding: 15px;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
    }

    h3 { margin: 0 0 10px 0; font-size: 16px; color: var(--text); }

    .btn-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    button {
      border: none;
      padding: 10px 16px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      font-size: 13px;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 5px;
      box-shadow: 0 2px 0 rgba(0,0,0,0.1);
    }

    button:active { transform: translateY(2px); box-shadow: none; }
    
    .btn-cmd { background: white; border: 1px solid #d1d5db; color: var(--text); }
    .btn-cmd:hover { background: #f3f4f6; border-color: var(--accent); }

    .btn-run { background: var(--success); color: white; width: 100%; justify-content: center; font-size: 15px; }
    .btn-run:hover { background: #059669; }
    
    .btn-reset { background: var(--danger); color: white; }
    .btn-clear { background: #6b7280; color: white; }

    /* Command List */
    .command-display {
      min-height: 80px;
      max-height: 200px;
      overflow-y: auto;
      background: white;
      border: 2px dashed #d1d5db;
      border-radius: 10px;
      padding: 10px;
      display: flex;
      flex-wrap: wrap;
      align-content: flex-start;
      gap: 6px;
    }

    .cmd-pill {
      padding: 5px 10px;
      border-radius: 20px;
      background: #eff6ff;
      border: 1px solid #bfdbfe;
      font-size: 12px;
      color: #1e40af;
      transition: 0.3s;
    }

    .cmd-pill.active {
      background: #fcd34d; /* Yellow highlight */
      border-color: #f59e0b;
      color: #78350f;
      transform: scale(1.1);
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      font-weight: bold;
    }

    .message-area {
      min-height: 40px;
      padding: 10px;
      background: #fffbeb;
      border-radius: 8px;
      color: #92400e;
      font-size: 13px;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    @media (max-width: 768px) {
      .app { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

  <div class="header-bar">
    <div class="level-badge" id="levelBadge">Level 1</div>
    <h1 style="margin:5px 0;">ü§ñ Robot Pintar: Misi Pulang</h1>
    <p style="margin:0; opacity: 0.7;">Elakkan batu, sampai ke rumah!</p>
  </div>

  <div class="app">
    <div class="grid-container">
      <div class="grid" id="grid"></div>
    </div>

    <div class="panel">
      
      <div class="control-group">
        <h3>1. Susun Langkah</h3>
        <div class="btn-row">
          <button class="btn-cmd" onclick="addCmd('FORWARD')">‚¨ÜÔ∏è Maju</button>
          <button class="btn-cmd" onclick="addCmd('LEFT')">‚Ü©Ô∏è Pusing Kiri</button>
          <button class="btn-cmd" onclick="addCmd('RIGHT')">‚Ü™Ô∏è Pusing Kanan</button>
        </div>
      </div>

      <div class="control-group">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;">
          <h3>2. Senarai Kod</h3>
          <button class="btn-clear" onclick="clearCmds()" style="padding:4px 8px; font-size:11px;">üßπ Padam Semua</button>
        </div>
        <div class="command-display" id="cmdList">
          <div style="color:#9ca3af; font-size:12px; width:100%; text-align:center; padding-top:20px;">
            Kod kosong...
          </div>
        </div>
      </div>

      <div class="btn-row">
        <button class="btn-run" id="btnRun" onclick="runProgram()">‚ñ∂Ô∏è Jalankan Kod!</button>
      </div>
      
      <div class="btn-row" style="justify-content: center;">
        <button class="btn-reset" onclick="resetLevel()">üîÑ Mula Semula (Reset)</button>
        <button class="btn-cmd" onclick="nextLevel()" id="btnNext" style="display:none; background:#8b5cf6; color:white;">üöÄ Level Seterusnya</button>
      </div>

      <div class="message-area" id="msgBox">
        Selamat datang! Sila masukkan arahan.
      </div>

    </div>
  </div>

<script>
  // --- DATA LEVEL ---
  const levels = [
    {
      id: 1,
      start: { x: 0, y: 4, dir: 'E' },
      goal: { x: 4, y: 0 },
      obstacles: [] // Tiada halangan (Mudah)
    },
    {
      id: 2,
      start: { x: 0, y: 2, dir: 'E' },
      goal: { x: 4, y: 2 },
      obstacles: [{x: 2, y: 2}] // Satu batu di tengah
    },
    {
      id: 3,
      start: { x: 0, y: 0, dir: 'S' },
      goal: { x: 4, y: 4 },
      obstacles: [{x: 1, y: 1}, {x: 2, y: 2}, {x: 3, y: 3}, {x: 1, y: 3}] // Banyak batu
    }
  ];

  let currentLevelIdx = 0;
  let player = {};
  let commands = [];
  let isRunning = false;
  
  // Audio Ringkas (Beep)
  const context = new (window.AudioContext || window.webkitAudioContext)();
  function beep(freq = 440, type = 'sine', duration = 0.1) {
    if(context.state === 'suspended') context.resume();
    const osc = context.createOscillator();
    const gain = context.createGain();
    osc.type = type;
    osc.frequency.value = freq;
    osc.connect(gain);
    gain.connect(context.destination);
    osc.start();
    gain.gain.exponentialRampToValueAtTime(0.00001, context.currentTime + duration);
    osc.stop(context.currentTime + duration);
  }

  // --- UI REFERENCES ---
  const gridEl = document.getElementById('grid');
  const cmdListEl = document.getElementById('cmdList');
  const msgBox = document.getElementById('msgBox');
  const levelBadge = document.getElementById('levelBadge');
  const btnNext = document.getElementById('btnNext');
  const btnRun = document.getElementById('btnRun');

  // --- LOGIC ---

  function initLevel() {
    const config = levels[currentLevelIdx];
    player = { ...config.start }; // Copy start state
    levelBadge.innerText = `Level ${config.id}`;
    btnNext.style.display = 'none';
    btnRun.disabled = false;
    isRunning = false;
    renderGrid();
    renderCommands();
    showMessage("Susun arahan untuk bawa robot ke rumah üè†");
  }

  function renderGrid() {
    gridEl.innerHTML = '';
    const config = levels[currentLevelIdx];

    for(let y=0; y<5; y++) {
      for(let x=0; x<5; x++) {
        const cell = document.createElement('div');
        cell.className = 'cell';

        // Render Goal
        if(x === config.goal.x && y === config.goal.y) {
          cell.classList.add('goal');
          cell.innerText = 'üè†';
        }

        // Render Obstacles
        const isObstacle = config.obstacles.some(obs => obs.x === x && obs.y === y);
        if(isObstacle) {
          cell.classList.add('obstacle');
          cell.innerText = 'ü™®';
        }

        // Render Player
        if(x === player.x && y === player.y) {
          const robot = document.createElement('div');
          robot.className = 'robot';
          robot.innerText = 'ü§ñ';
          // Rotate based on direction
          let deg = 0;
          if(player.dir === 'E') deg = 0;
          if(player.dir === 'S') deg = 90;
          if(player.dir === 'W') deg = 180;
          if(player.dir === 'N') deg = 270;
          
          // CSS rotate is weird with emojis, let's fix orientation
          // Standard emoji faces forward (or use arrow). Let's imply direction via transform.
          // Using an arrow overlay might be clearer, but let's stick to rotation for fun.
          // Adjust so 0 deg (East) faces right.
          // If the emoji is neutral, maybe add a small arrow. Let's rely on rotation.
          robot.style.transform = `rotate(${deg}deg)`;
          
          // If crashed
          if(player.crashed) {
            robot.innerText = 'üí•';
            robot.style.transform = 'scale(1.5)';
          }
          
          cell.appendChild(robot);
        }

        gridEl.appendChild(cell);
      }
    }
  }

  function addCmd(type) {
    if(isRunning) return;
    commands.push(type);
    beep(600, 'sine', 0.05);
    renderCommands();
  }

  function clearCmds() {
    if(isRunning) return;
    commands = [];
    renderCommands();
  }

  function renderCommands(activeIndex = -1) {
    cmdListEl.innerHTML = '';
    if(commands.length === 0) {
      cmdListEl.innerHTML = '<div style="color:#9ca3af; font-size:12px; width:100%; text-align:center; padding-top:20px;">Kod kosong...</div>';
      return;
    }

    commands.forEach((cmd, idx) => {
      const pill = document.createElement('div');
      pill.className = 'cmd-pill';
      if(idx === activeIndex) pill.classList.add('active');
      
      let icon = '';
      if(cmd === 'FORWARD') icon = '‚¨ÜÔ∏è';
      if(cmd === 'LEFT') icon = '‚Ü©Ô∏è';
      if(cmd === 'RIGHT') icon = '‚Ü™Ô∏è';
      
      pill.innerText = `${idx+1}. ${icon}`;
      cmdListEl.appendChild(pill);
    });
  }

  function resetLevel() {
    isRunning = false;
    // clearCmds(); // Optional: keep commands or clear them? User usually wants to tweak, not clear.
    // Let's NOT clear commands on reset so they can debug.
    initLevel();
  }

  function showMessage(text, isError = false) {
    msgBox.innerText = text;
    msgBox.style.color = isError ? '#b91c1c' : '#047857';
    msgBox.style.background = isError ? '#fee2e2' : '#d1fae5';
  }

  // --- RUNTIME ---

  async function runProgram() {
    if(commands.length === 0) {
      showMessage("Tiada arahan! Sila masukkan butang Maju/Pusing.", true);
      return;
    }
    if(isRunning) return;

    isRunning = true;
    btnRun.disabled = true;
    
    // Reset position first without clearing commands
    const config = levels[currentLevelIdx];
    player = { ...config.start };
    renderGrid();

    for(let i=0; i < commands.length; i++) {
      if(!isRunning) break; // If user hit reset mid-run

      renderCommands(i); // Highlight current command
      const cmd = commands[i];
      
      await new Promise(r => setTimeout(r, 600)); // Wait bit
      
      processCommand(cmd);
      renderGrid();
      beep(300, 'triangle', 0.1);

      // Check WIN
      if(player.x === config.goal.x && player.y === config.goal.y) {
        beep(800, 'sine', 0.1); setTimeout(()=>beep(1200, 'sine', 0.2), 150);
        showMessage("TAHNIAH! üéâ Robot sampai rumah!");
        if(currentLevelIdx < levels.length - 1) {
            btnNext.style.display = 'block';
        } else {
            showMessage("HEBAT! Anda tamatkan semua level! üèÜ");
        }
        isRunning = false;
        return;
      }

      // Check CRASH (Obstacle)
      if(checkCollision(player.x, player.y)) {
        player.crashed = true;
        renderGrid();
        beep(150, 'sawtooth', 0.4);
        showMessage("ALAMAK! Robot langgar batu! üí• Reset dan cuba lagi.", true);
        isRunning = false;
        btnRun.disabled = false;
        return;
      }
    }

    isRunning = false;
    btnRun.disabled = false;
    renderCommands(-1); // Remove highlight
    if(!(player.x === config.goal.x && player.y === config.goal.y)) {
      showMessage("Program tamat. Robot belum sampai lagi. Cuba tambah arahan.", true);
    }
  }

  function processCommand(cmd) {
    if(cmd === 'LEFT') {
      const dirs = ['N', 'W', 'S', 'E'];
      const idx = dirs.indexOf(player.dir);
      player.dir = dirs[(idx + 1) % 4];
    } else if (cmd === 'RIGHT') {
      const dirs = ['N', 'E', 'S', 'W'];
      const idx = dirs.indexOf(player.dir);
      player.dir = dirs[(idx + 1) % 4];
    } else if (cmd === 'FORWARD') {
      let newX = player.x;
      let newY = player.y;
      if(player.dir === 'N') newY--;
      if(player.dir === 'E') newX++;
      if(player.dir === 'S') newY++;
      if(player.dir === 'W') newX--;

      // Wall collision check
      if(newX < 0 || newX > 4 || newY < 0 || newY > 4) {
        // Wall hit - stay in place but maybe shake?
        return; 
      }
      player.x = newX;
      player.y = newY;
    }
  }

  function checkCollision(x, y) {
    const config = levels[currentLevelIdx];
    return config.obstacles.some(obs => obs.x === x && obs.y === y);
  }

  function nextLevel() {
    currentLevelIdx++;
    commands = []; // Clear commands for new level
    initLevel();
  }

  // Start
  initLevel();

</script>
</body>
</html>
